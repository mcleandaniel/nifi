process_group:
  name: NiFi Flow
  process_groups:
    - name: Tools_Trust_Inspect
      description: |
        Inspect a dedicated truststore (text output). Operator-only; trigger via GenerateFlowFile Run once.
      processors:
        - id: gen-inspect
          name: Trigger (inspect)
          type: org.apache.nifi.processors.standard.GenerateFlowFile
          properties:
            Batch Size: "1"
            Scheduling Strategy: TIMER_DRIVEN
            Run Schedule: "24000 h"
        - id: ua-inspect
          name: Params (inspect)
          type: org.apache.nifi.processors.attributes.UpdateAttribute
          properties:
            ts.name: local-nifi
            ts.type: JKS
            ts.pass: changeMe123!
        - id: exec-inspect
          name: Exec (inspect)
          type: org.apache.nifi.processors.standard.ExecuteStreamCommand
          properties:
            Command Path: /bin/bash
            Command Arguments Strategy: Command Arguments Property
            Argument Delimiter: ";"
            Command Arguments: >-
              -lc;set -euo pipefail; TS_DIR=/opt/nifi/nifi-current/conf/truststores; NAME='${ts.name}'; TYPE='${ts.type}'; PASS='${ts.pass}'; FILE="$TS_DIR/${NAME}.p12";
              keytool -list -v -rfc -keystore "$FILE" -storetype "$TYPE" -storepass "$PASS" | sed -n '1,160p'
            Ignore STDIN: "true"
            Working Directory: /opt/nifi
        - id: log-inspect
          name: Log (inspect)
          type: org.apache.nifi.processors.standard.LogAttribute
          properties: {}
      connections:
        - source: gen-inspect
          destination: ua-inspect
          relationships: [success]
        - source: ua-inspect
          destination: exec-inspect
          relationships: [success]
        - source: exec-inspect
          destination: log-inspect
          relationships: [output stream]
