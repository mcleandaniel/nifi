
process_group:
  name: SimpleWorkflow
  position: [0, 0]

controller_services:
  - id: json-reader
    name: JsonTreeReader
    type: org.apache.nifi.json.JsonTreeReader
  - id: json-writer
    name: JsonRecordSetWriter
    type: org.apache.nifi.json.JsonRecordSetWriter

processors:
  - id: generate
    name: GenerateRecord
    type: org.apache.nifi.processors.standard.GenerateRecord
    position: [0, 0]
    properties:
      record-reader: json-reader
      record-writer: json-writer
      schema: |
        {
          "type": "record",
          "name": "test",
          "fields": [
            { "name": "status", "type": "string" },
            { "name": "value", "type": "int" }
          ]
        }
  - id: update
    name: UpdateRecord
    type: org.apache.nifi.processors.standard.UpdateRecord
    position: [400, 0]
    properties:
      record-reader: json-reader
      record-writer: json-writer
      /status: "UPPER(/status)"
  - id: query
    name: QueryRecord
    type: org.apache.nifi.processors.standard.QueryRecord
    position: [800, 0]
    properties:
      record-reader: json-reader
      record-writer: json-writer
      success: "SELECT * FROM FLOWFILE WHERE status = 'OK'"
      failure: "SELECT * FROM FLOWFILE WHERE status != 'OK'"
  - id: log_success
    name: LogAttribute (Success)
    type: org.apache.nifi.processors.standard.LogAttribute
    position: [1200, -200]
  - id: log_failure
    name: LogAttribute (Failure)
    type: org.apache.nifi.processors.standard.LogAttribute
    position: [1200, 200]

connections:
  - name: Generate to Update
    source: generate
    destination: update
    relationships: [success]
    back_pressure_object_threshold: 1000
  - name: Update to Query
    source: update
    destination: query
    relationships: [success]
  - name: Query to Log Success
    source: query
    destination: log_success
    relationships: [success]
  - name: Query to Log Failure
    source: query
    destination: log_failure
    relationships: [failure]

auto_terminate:
  log_success:
    - success
  log_failure:
    - success
